# 建德垃圾焚烧预警报警系统

基于预警规则和报警规则实现的建德垃圾焚烧厂预警报警算法。

## 功能特点

- ✅ **预警检测**：瞬时低炉温、炉膛温度偏高/过高、压力异常、氧含量异常、污染物浓度超标
- ✅ **报警检测**：低炉温焚烧、污染物排放超标
- ✅ **数据折算**：自动进行污染物浓度标准状态折算
- ✅ **批量处理**：支持单文件和批量文件夹分析
- ✅ **多种运行方式**：直接运行、命令行、函数调用

## 快速开始

### 方式1：直接运行（推荐）

1. 修改 `suanfa.py` 中的 `DEFAULT_FILE` 变量为你要分析的文件路径
2. 双击运行 `suanfa.py` 或在命令行执行：
```bash
python suanfa.py
```

### 方式2：命令行指定文件

```bash
# 分析单个文件
python suanfa.py "建德数据/2025年6月/6.1_process.xlsx"

# 批量分析文件夹
python suanfa.py --batch "建德数据"

# 指定输出目录
python suanfa.py "建德数据/2025年6月/6.1_process.xlsx" "./my_output"
```

### 方式3：在其他脚本中调用

```python
from suanfa import analyze_file, quick_analyze

# 分析指定文件
result = analyze_file("建德数据/2025年6月/6.1_process.xlsx")

# 快速分析（使用默认文件）
result = quick_analyze()
```

## 文件说明

- `suanfa.py` - 主算法文件，包含所有预警报警逻辑
- `config.py` - 配置文件，可修改阈值和参数
- `使用示例.py` - 详细的使用示例
- `test_algorithm.py` - 算法测试脚本
- `README.md` - 本说明文件

## 预警规则

### 预警类型（小时均值或实时）

1. **瞬时低炉温焚烧**：5分钟窗口平均温度 < 850℃
2. **炉膛温度偏高**：1小时平均温度 > 1200℃
3. **炉膛温度过高**：1小时平均温度 > 1300℃
4. **布袋除尘器压力损失偏高**：实时压差 > 2000Pa
5. **布袋除尘器压力损失偏低**：实时压差 < 500Pa
6. **焚烧炉出口氧含量偏高**：实时氧含量 > 10%
7. **焚烧炉出口氧含量偏低**：实时氧含量 < 6%
8. **污染物浓度较高**（小时均值，折算后）：
   - 颗粒物（PM）> 30mg/m³
   - 氮氧化物（NOx）> 300mg/m³
   - 二氧化硫（SO₂）> 100mg/m³
   - 氯化氢（HCl）> 60mg/m³
   - 一氧化碳（CO）> 100mg/m³

### 报警类型（日均值）

1. **低炉温焚烧**：5分钟窗口平均温度 < 850℃
2. **污染物排放超标**（日均值，折算后）：
   - 颗粒物（PM）> 20mg/m³
   - 氮氧化物（NOx）> 250mg/m³
   - 二氧化硫（SO₂）> 80mg/m³
   - 氯化氢（HCl）> 50mg/m³
   - 一氧化碳（CO）> 80mg/m³

## 数据字段要求

算法需要以下数据字段（基于 `process_report_format.py`）：

### 温度字段
- 上部烟气温度左/中/右
- 中部烟气温度左/中/右
- 下部烟气温度左/中/右

### 其他字段
- 除尘器差压
- 烟气氧量
- 烟气烟尘、NOX浓度、SO2浓度、HCL浓度、CO浓度、NH3浓度

## 输出结果

算法会生成以下文件：

1. **Excel报告**：`文件名_建德预警报警报告_时间戳.xlsx`
2. **CSV报告**：`文件名_建德预警报警报告_时间戳.csv`

输出格式：
```
时间,炉号,预警/报警类型,预警/报警事件
2025-06-01 08:30:00,1,预警,瞬时低炉温焚烧
2025-06-01 14:15:00,1,预警,烟气中氮氧化物（NOx）浓度较高
```

## 自定义配置

### 修改默认文件路径

编辑 `suanfa.py` 中的配置：
```python
DEFAULT_FILE = "你的文件路径.xlsx"
DEFAULT_FOLDER = "你的文件夹路径"
```

### 修改预警阈值

编辑 `config.py` 中的阈值配置：
```python
JIANDE_WARNING_THRESHOLDS = {
    'low_furnace_temp': 850,      # 修改为你需要的温度
    'dust_warning_limit': 30,     # 修改为你需要的浓度
    # ... 其他阈值
}
```

## 故障排除

### 常见问题

1. **文件不存在错误**
   - 检查文件路径是否正确
   - 确保文件格式为 `.xlsx` 或 `.csv`

2. **字段不匹配错误**
   - 检查数据文件是否包含必需的字段
   - 确认字段名称与 `JIANDE_FIELD_MAPPING` 中的定义一致

3. **无预警事件**
   - 检查数据是否正常（无异常值）
   - 确认预警阈值设置是否合理

4. **运行缓慢**
   - 大文件处理需要时间，请耐心等待
   - 可以先用小文件测试

### 获取帮助

如果遇到问题，可以：
1. 运行 `test_algorithm.py` 测试算法是否正常
2. 查看 `使用示例.py` 了解详细用法
3. 检查 `config.py` 中的配置是否正确

## 技术说明

- **开发语言**：Python 3.7+
- **主要依赖**：pandas, numpy, openpyxl
- **数据处理**：支持时间序列重采样、异常值检测、数据折算
- **预警逻辑**：基于滑动窗口和阈值比较
- **状态跟踪**：支持连续预警状态跟踪

## 更新日志

- **v1.0**：初始版本，支持基本预警报警功能
- **v1.1**：添加批量处理和多种运行方式
- **v1.2**：优化用户体验，添加配置文件和测试脚本
