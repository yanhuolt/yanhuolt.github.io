# ğŸ‰ LSTMç®—æ³•ä¿®æ”¹å®Œæˆè¯´æ˜

## ğŸ“‹ ä¿®æ”¹ç›®æ ‡
å°†æœ€ä½³æ¨¡å‹ä¿å­˜åœ¨`lstmç®—æ³•/checkpoints`ä¸­ï¼Œå°†å¯è§†åŒ–çš„é¢„æµ‹ç»“æœä¿å­˜åœ¨`lstmç®—æ³•/å¯è§†åŒ–ç»“æœ`ä¸­ã€‚

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. ç›®å½•ç»“æ„åˆ›å»º
```
lstmç®—æ³•/
â”œâ”€â”€ checkpoints/              # æ¨¡å‹ä¿å­˜ç›®å½•ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ å¯è§†åŒ–ç»“æœ/               # å¯è§†åŒ–ç»“æœä¿å­˜ç›®å½•ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ air_quality_forecast_system.py  # æ ¸å¿ƒé¢„æŠ¥ç³»ç»Ÿï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ test_pytorch_forecast_system.py # æµ‹è¯•è„šæœ¬ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ visualization_utils.py    # å¯è§†åŒ–å·¥å…·ï¼ˆå·²ä¿®æ”¹ï¼‰
â””â”€â”€ å…¶ä»–æ–‡ä»¶...
```

### 2. æ ¸å¿ƒç³»ç»Ÿä¿®æ”¹ (`air_quality_forecast_system.py`)

#### 2.1 æ„é€ å‡½æ•°å¢å¼º
```python
def __init__(self, sequence_length=24, forecast_horizon=72, device=None, model_save_path=None):
    # æ–°å¢ model_save_path å‚æ•°
    self.model_save_path = model_save_path if model_save_path else 'best_model.pth'
```

#### 2.2 æ¨¡å‹ä¿å­˜è·¯å¾„è‡ªå®šä¹‰
```python
# æ—©åœæœºåˆ¶ä¸­çš„æ¨¡å‹ä¿å­˜
if val_loss < best_val_loss:
    best_val_loss = val_loss
    patience_counter = 0
    # ä¿å­˜æœ€ä½³æ¨¡å‹åˆ°æŒ‡å®šè·¯å¾„
    torch.save(self.model.state_dict(), self.model_save_path)
    print(f"ä¿å­˜æœ€ä½³æ¨¡å‹è‡³: {self.model_save_path}")

# è®­ç»ƒå®ŒæˆååŠ è½½æœ€ä½³æ¨¡å‹
self.model.load_state_dict(torch.load(self.model_save_path))
print(f"æ¨¡å‹è®­ç»ƒå®Œæˆï¼æœ€ä½³æ¨¡å‹å·²ä¿å­˜è‡³: {self.model_save_path}")
```

### 3. æµ‹è¯•è„šæœ¬ä¿®æ”¹ (`test_pytorch_forecast_system.py`)

#### 3.1 ç›®å½•è‡ªåŠ¨åˆ›å»º
```python
# åˆ›å»ºå¿…è¦çš„ç›®å½•
checkpoints_dir = "lstmç®—æ³•/checkpoints"
visualization_dir = "lstmç®—æ³•/å¯è§†åŒ–ç»“æœ"

os.makedirs(checkpoints_dir, exist_ok=True)
os.makedirs(visualization_dir, exist_ok=True)
```

#### 3.2 æ–‡ä»¶å‘½åè§„èŒƒ
```python
# åˆ›å»ºæ—¶é—´æˆ³ç”¨äºæ–‡ä»¶å‘½å
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
model_save_path = os.path.join(checkpoints_dir, f"best_lstm_model_{timestamp}.pth")

# å¯è§†åŒ–æ–‡ä»¶å‘½å
viz_filename = f"LSTMé¢„æŠ¥ç»“æœ_{timestamp}.png"
viz_save_path = os.path.join(visualization_dir, viz_filename)
```

#### 3.3 å¢å¼ºçš„å¯è§†åŒ–ä¿å­˜
```python
# ä¸“ä¸šå¯è§†åŒ–ä¿å­˜
plot_forecast_results(system_output, current_data, save_path=viz_save_path)

# å¤‡ç”¨å¯è§†åŒ–ä¿å­˜
backup_viz_path = os.path.join(visualization_dir, f"ç®€å•é¢„æŠ¥å›¾_{timestamp}.png")
plt.savefig(backup_viz_path, dpi=300, bbox_inches='tight')
```

#### 3.4 ç»“æœæ€»ç»“ç”Ÿæˆ
```python
# ç”Ÿæˆè¯¦ç»†çš„ç»“æœæ€»ç»“æ–‡ä»¶
summary_path = os.path.join(visualization_dir, f"é¢„æŠ¥ç³»ç»Ÿæ€»ç»“_{timestamp}.txt")
with open(summary_path, 'w', encoding='utf-8') as f:
    f.write("=== PyTorch LSTMç©ºæ°”è´¨é‡é¢„æŠ¥é¢„è­¦ç³»ç»Ÿæµ‹è¯•æ€»ç»“ ===\n")
    # åŒ…å«ç³»ç»Ÿä¿¡æ¯ã€æ•°æ®ä¿¡æ¯ã€é¢„æŠ¥ç»“æœã€æ–‡ä»¶ä½ç½®ç­‰
```

### 4. å¯è§†åŒ–å·¥å…·å¢å¼º (`visualization_utils.py`)

#### 4.1 ç›®å½•è‡ªåŠ¨åˆ›å»º
```python
if save_path:
    # ç¡®ä¿ä¿å­˜ç›®å½•å­˜åœ¨
    import os
    save_dir = os.path.dirname(save_path)
    if save_dir and not os.path.exists(save_dir):
        os.makedirs(save_dir, exist_ok=True)
    
    plt.savefig(save_path, dpi=300, bbox_inches='tight')
    print(f"å›¾è¡¨å·²ä¿å­˜è‡³: {save_path}")
```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨
```python
from air_quality_forecast_system import AirQualityForecastSystem
from datetime import datetime
import os

# åˆ›å»ºæ—¶é—´æˆ³
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")

# å®šä¹‰ä¿å­˜è·¯å¾„
checkpoints_dir = "lstmç®—æ³•/checkpoints"
visualization_dir = "lstmç®—æ³•/å¯è§†åŒ–ç»“æœ"
model_save_path = os.path.join(checkpoints_dir, f"best_lstm_model_{timestamp}.pth")

# åˆ›å»ºé¢„æŠ¥ç³»ç»Ÿ
forecast_system = AirQualityForecastSystem(
    sequence_length=24,
    forecast_horizon=48,
    model_save_path=model_save_path  # æŒ‡å®šæ¨¡å‹ä¿å­˜è·¯å¾„
)

# è¿è¡Œç³»ç»Ÿ
system_output = forecast_system.run_forecast_system(
    historical_data=historical_data,
    current_data=current_data,
    target_pollutant='PM2.5'
)
```

### è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
cd lstmç®—æ³•
python test_pytorch_forecast_system.py
```

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

### æ¨¡å‹æ–‡ä»¶ (`checkpoints/`)
- `best_lstm_model_YYYYMMDD_HHMMSS.pth` - è®­ç»ƒå¥½çš„æœ€ä½³LSTMæ¨¡å‹

### å¯è§†åŒ–æ–‡ä»¶ (`å¯è§†åŒ–ç»“æœ/`)
- `LSTMé¢„æŠ¥ç»“æœ_YYYYMMDD_HHMMSS.png` - ä¸“ä¸šé¢„æŠ¥ç»“æœå›¾è¡¨
- `ç®€å•é¢„æŠ¥å›¾_YYYYMMDD_HHMMSS.png` - å¤‡ç”¨ç®€å•é¢„æŠ¥å›¾
- `é¢„æŠ¥ç³»ç»Ÿæ€»ç»“_YYYYMMDD_HHMMSS.txt` - è¯¦ç»†ç»“æœæ€»ç»“

## ğŸŒŸ æ–°å¢åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½æ–‡ä»¶ç®¡ç†
- âœ… è‡ªåŠ¨åˆ›å»ºå¿…è¦ç›®å½•
- âœ… æ—¶é—´æˆ³æ–‡ä»¶å‘½åï¼Œé¿å…è¦†ç›–
- âœ… è·¯å¾„éªŒè¯å’Œé”™è¯¯å¤„ç†

### 2. å¢å¼ºçš„æ¨¡å‹ä¿å­˜
- âœ… è‡ªå®šä¹‰æ¨¡å‹ä¿å­˜è·¯å¾„
- âœ… è®­ç»ƒè¿‡ç¨‹ä¸­å®æ—¶ä¿å­˜æœ€ä½³æ¨¡å‹
- âœ… ä¿å­˜çŠ¶æ€æ—¥å¿—è¾“å‡º

### 3. å®Œæ•´çš„å¯è§†åŒ–ç³»ç»Ÿ
- âœ… å¤šç§å¯è§†åŒ–æ ¼å¼æ”¯æŒ
- âœ… é«˜åˆ†è¾¨ç‡å›¾ç‰‡ä¿å­˜ï¼ˆ300 DPIï¼‰
- âœ… å¤‡ç”¨å¯è§†åŒ–æ–¹æ¡ˆ

### 4. è¯¦ç»†çš„ç»“æœè®°å½•
- âœ… ç³»ç»Ÿé…ç½®ä¿¡æ¯è®°å½•
- âœ… è®­ç»ƒå’Œé¢„æŠ¥ç»“æœç»Ÿè®¡
- âœ… æ–‡ä»¶ä½ç½®ç´¢å¼•

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

### é”™è¯¯å¤„ç†
- ç›®å½•åˆ›å»ºå¤±è´¥å¤„ç†
- å¯è§†åŒ–ä¿å­˜å¼‚å¸¸å¤„ç†
- æ¨¡å‹ä¿å­˜è·¯å¾„éªŒè¯

### æ€§èƒ½ä¼˜åŒ–
- é¿å…é‡å¤ç›®å½•åˆ›å»º
- é«˜æ•ˆçš„æ–‡ä»¶è·¯å¾„å¤„ç†
- å†…å­˜å‹å¥½çš„å¯è§†åŒ–ä¿å­˜

### ç”¨æˆ·ä½“éªŒ
- æ¸…æ™°çš„è¿›åº¦æç¤º
- è¯¦ç»†çš„æ–‡ä»¶ä½ç½®è¾“å‡º
- å®Œæ•´çš„æ“ä½œæ—¥å¿—

## ğŸ“Š æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬åï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

```
=== PyTorch LSTMç©ºæ°”è´¨é‡é¢„æŠ¥é¢„è­¦ç³»ç»Ÿæµ‹è¯• ===

æ¨¡å‹ä¿å­˜ç›®å½•: lstmç®—æ³•/checkpoints
å¯è§†åŒ–ä¿å­˜ç›®å½•: lstmç®—æ³•/å¯è§†åŒ–ç»“æœ
PyTorchç‰ˆæœ¬: x.x.x
CUDAå¯ç”¨: True/False

1. ç”Ÿæˆåˆæˆæµ‹è¯•æ•°æ®...
2. åˆå§‹åŒ–LSTMé¢„æŠ¥ç³»ç»Ÿ...
3. è¿è¡Œé¢„æŠ¥é¢„è­¦ç³»ç»Ÿ...
...
8. ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨...
âœ… å¯è§†åŒ–å›¾è¡¨å·²ä¿å­˜è‡³: lstmç®—æ³•/å¯è§†åŒ–ç»“æœ/LSTMé¢„æŠ¥ç»“æœ_20240130_120000.png
9. ç”Ÿæˆç»“æœæ€»ç»“...
âœ… ç»“æœæ€»ç»“å·²ä¿å­˜è‡³: lstmç®—æ³•/å¯è§†åŒ–ç»“æœ/é¢„æŠ¥ç³»ç»Ÿæ€»ç»“_20240130_120000.txt

âœ… PyTorch LSTMé¢„æŠ¥é¢„è­¦ç³»ç»Ÿæµ‹è¯•å®Œæˆï¼

ğŸ“ æ‰€æœ‰ç»“æœæ–‡ä»¶ä¿å­˜ä½ç½®:
   æ¨¡å‹æ–‡ä»¶: lstmç®—æ³•/checkpoints/best_lstm_model_20240130_120000.pth
   å¯è§†åŒ–ç»“æœ: lstmç®—æ³•/å¯è§†åŒ–ç»“æœ
   ç»“æœæ€»ç»“: lstmç®—æ³•/å¯è§†åŒ–ç»“æœ/é¢„æŠ¥ç³»ç»Ÿæ€»ç»“_20240130_120000.txt
```

## ğŸ‰ ä¿®æ”¹å®Œæˆ

âœ… **æ¨¡å‹ä¿å­˜**: æœ€ä½³æ¨¡å‹è‡ªåŠ¨ä¿å­˜åˆ° `lstmç®—æ³•/checkpoints` ç›®å½•  
âœ… **å¯è§†åŒ–ä¿å­˜**: é¢„æµ‹ç»“æœå›¾è¡¨ä¿å­˜åˆ° `lstmç®—æ³•/å¯è§†åŒ–ç»“æœ` ç›®å½•  
âœ… **æ–‡ä»¶ç®¡ç†**: æ™ºèƒ½ç›®å½•åˆ›å»ºå’Œæ–‡ä»¶å‘½å  
âœ… **ç»“æœè®°å½•**: å®Œæ•´çš„æµ‹è¯•æ€»ç»“å’Œæ–‡ä»¶ç´¢å¼•  

ç°åœ¨æ‚¨å¯ä»¥è¿è¡Œ `test_pytorch_forecast_system.py` æ¥æµ‹è¯•å®Œæ•´çš„åŠŸèƒ½ï¼
