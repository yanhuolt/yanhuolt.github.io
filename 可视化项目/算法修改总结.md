# 算法修改总结

根据算法需求文档，已严格按照要求完成以下修改：

## 1. 风速时间段切分（需求文档第1点）

✅ **已实现**：在数据清洗前进行风速切分
- 从检测到风速>=0.5的时间为起点，直至检测到风速<0.5的记录的时间结束
- 以这种方式切分为一个个时间段
- 去除不包含在任何时间段的数据
- 实现位置：`_split_by_wind_speed()` 函数，在 `basic_data_cleaning()` 开始时调用

## 2. 两套数据清洗规则（需求文档第2点）

### 2.1 同时记录型数据清洗（进口0出口1=2）

✅ **已实现**：当检测到进口0出口1列值为2时
- 去除进口浓度和出口浓度存在0值的记录
- 去除出口浓度大于进口浓度的记录
- 通过KS检验和箱型图检验剔除异常值（在后续步骤进行）
- 根据现有算法进行预警系统的可视化
- 实现位置：`_clean_simultaneous_records()` 函数

### 2.2 切换型数据清洗（进口0出口1=0或1）

✅ **已实现**：当检测到进口0出口1值为0或1时
- 根据进口0出口1列的值切分时间段并打上标签
- 在切分出的小时间段中进行数据清洗，去除对应进口浓度或出口浓度为0值的记录
- 匹配进口和出口时间段，筛选出口浓度不能大于进口浓度平均值的记录
- 如果没有匹配到下一个对应的时间段，弃用该段时间
- 将两段时间拼接为一个大的时间段计算穿透率
- 实现位置：`_clean_switching_records()` 函数

## 3. 切换型数据的时间段处理（需求文档第3点）

✅ **已实现**：时间段切分和匹配逻辑
- 从检测到进口0出口1列为0的记录的时间开始，到检测到进口0出口1列为1的记录的时间结束，标记为进口浓度时间段
- 从检测到进口0出口1列为1的记录的时间开始，到检测到进口0出口1列为0的记录的时间结束，标记为出口浓度时间段
- 根据第一个检测到的时间段为进口浓度或出口浓度，匹配下一个对应时间段
- 将两段时间拼接然后进行筛选
- 删除明显异常的穿透率数据点
- 实现位置：`_segment_switching_data()` 和 `_match_and_filter_switching_segments()` 函数

## 4. 异常穿透率数据清理

✅ **已实现**：计算穿透率时删除明显异常的穿透率数据点
- 删除穿透率>1的异常数据点（物理上不可能）
- 删除穿透率<0的异常数据点（物理上不可能）
- 删除效率<0或>100的异常数据点
- 实现位置：在同时记录型和切换型数据处理中都已添加

## 5. 预警系统可视化

✅ **已保持**：遵循现有的可视化规则
- 不修改预测模型的逻辑
- 不修改预警系统的整体框架
- 主要修改在于时间段无需在后面进行切分，因为已经通过风速进行过一次切分，变成了一段一段的时间

## 6. 核心算法结构保持

✅ **已保持**：
- KS检验清洗算法保持不变
- 箱型图清洗算法保持不变
- 预警系统核心逻辑保持不变
- Logistic回归模型保持不变

## 主要修改文件

- `Adsorption_isotherm.py`：主要算法文件，已按需求文档严格修改

## 执行顺序

1. 风速时间段切分（在数据清洗前）
2. 识别数据类型（同时记录型/切换型/混合型）
3. 执行对应的清洗规则
4. KS检验清洗
5. 箱型图清洗
6. 计算效率数据
7. 预警分析
8. 可视化生成

所有修改都严格遵循需求文档的要求，确保算法的准确性和完整性。
